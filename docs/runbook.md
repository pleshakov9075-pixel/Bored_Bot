# Runbook

## Environment setup

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω `.env.example` –≤ `.env`.
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:
   - `BOT_TOKEN`
   - `GENAPI_TOKEN`
   - `DATABASE_URL_ASYNC`
   - `DATABASE_URL_SYNC`
   - `INTERNAL_API_KEY`
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
   - MinIO: `MINIO_ENDPOINT`, `MINIO_ACCESS_KEY`, `MINIO_SECRET_KEY`, `MINIO_BUCKET`, `MINIO_SECURE`
   - YooKassa: `YOOKASSA_SHOP_ID`, `YOOKASSA_SECRET_KEY`, `YOOKASSA_RETURN_URL`, `YOOKASSA_WEBHOOK_SECRET`

## Automated smoke checks

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
python -m app.tools.smoke_check
```

## Smoke tests

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á (text/image/suno).**
   - –í –±–æ—Ç–µ: `‚úçÔ∏è –¢–µ–∫—Å—Ç` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–ª–∞—Å—å –∏ –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å `task #<id>`.
   - –í –±–æ—Ç–µ: `üñº –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è` ‚Üí –≤—ã–±—Ä–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ/–¥–≤–∏–∂–æ–∫/—Ä–µ–∂–∏–º ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç ‚Üí –ø–æ–ª—É—á–∏—Ç—å `task #<id>`.
   - –í –±–æ—Ç–µ: `üéµ –ú—É–∑—ã–∫–∞` ‚Üí –ø—Ä–æ–π—Ç–∏ 3 —à–∞–≥–∞ Suno (title/tags/prompt) ‚Üí –ø–æ–ª—É—á–∏—Ç—å `task #<id>`.
2. **–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.**
   - –î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è `‚úÖ –ì–æ—Ç–æ–≤–æ! (task #<id>)` —Å —Ñ–∞–π–ª–æ–º/—Ç–µ–∫—Å—Ç–æ–º.
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö –≤–æ—Ä–∫–µ—Ä–∞ —Å–æ–±—ã—Ç–∏–µ `task_success` —Å —Ç–µ–º –∂–µ `task_id`.
3. **–°—Ü–µ–Ω–∞—Ä–∏–π —Ç–∞–π–º–∞—É—Ç–∞.**
   - –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–æ—Ç –≤—ã–≤–æ–¥–∏—Ç —Ç–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–æ–∂–∏–¥–∞–Ω–∏–µ > 30 –º–∏–Ω).
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–æ—Ä–∫–µ—Ä –ø–∏—à–µ—Ç —Å–æ–±—ã—Ç–∏–µ `task_failed` —Å `error_message`, –∞ `task_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –±–æ—Ç–∞.

## Feedback

* –ö–∞–Ω–∞–ª —Å–±–æ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ ‚Äî –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Ç–µ–≥–æ–º `event=feedback`.
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –±–æ—Ç: `<task_id> <–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π>`. `task_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º, —á—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –±–æ—Ç‚Äë—Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∏ –≤ –≤–æ—Ä–∫–µ—Ä‚Äë–ª–æ–≥–∞—Ö.
* –í –ª–æ–≥–∞—Ö —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è JSON —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ `event`, `task_id`, `user_id`, `message`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–≤—è–∑–∞—Ç—å –æ—Ç–∑—ã–≤ —Å `task_id` –∏–∑ `task_success`/`task_failed`.
